# HALO Agent Ablation Experiments Configuration
# For REAL v2 Benchmark Evaluation
#
# Experiments designed to answer: "Is RL useful for creating a browsing agent?"
#
# Run with: python scripts/eval_full_matrix.py --config configs/experiments.yaml

defaults:
  task_version: v2
  viewport_width: 1280
  viewport_height: 720
  max_steps: 70
  headless: true
  
experiments:
  # === BASELINE EXPERIMENTS ===
  
  # E1: Worker-only baseline (no manager, no cache)
  - name: baseline_worker
    mode: baseline_worker
    description: "Worker-only baseline with gpt-4o-mini"
    worker_model: gpt-4o-mini
    use_manager: false
    use_cache: false
    use_macros: false
    
  # E2: Worker with manager gating (no cache)
  - name: hierarchy_mgr_gate
    mode: hierarchy_mgr_gate
    description: "Worker + Manager (gated on errors/loops)"
    worker_model: gpt-4o-mini
    manager_model: gpt-4o
    use_manager: true
    use_cache: false
    use_macros: false
    
  # E3: Worker + Manager + VAC (no macros)
  - name: hierarchy_vac
    mode: hierarchy_vac
    description: "Worker + Manager + Verified Action Cache"
    worker_model: gpt-4o-mini
    manager_model: gpt-4o
    use_manager: true
    use_cache: true
    use_macros: false
    
  # E4: Full HALO (Worker + Manager + VAC + Macros)
  - name: hierarchy_vac_macros
    mode: hierarchy_vac_macros
    description: "Full HALO system with all components"
    worker_model: gpt-4o-mini
    manager_model: gpt-4o
    use_manager: true
    use_cache: true
    use_macros: true

  # === QWEN RL EXPERIMENTS ===
  
  # E5: Qwen worker zero-shot (no training)
  - name: qwen_zero
    mode: qwen_worker_zero
    description: "Qwen 3B zero-shot (no fine-tuning)"
    worker_model: Qwen/Qwen2.5-3B-Instruct
    use_manager: true
    use_cache: true
    use_macros: true
    
  # E6: Qwen worker with BC training
  - name: qwen_bc
    mode: qwen_worker_bc
    description: "Qwen 3B with Behavioral Cloning"
    worker_model: models/qwen_bc_lora
    use_manager: true
    use_cache: true
    use_macros: true
    
  # E7: Qwen worker with DPO training
  - name: qwen_dpo
    mode: qwen_worker_dpo
    description: "Qwen 3B with DPO preference learning"
    worker_model: models/qwen_dpo_lora
    use_manager: true
    use_cache: true
    use_macros: true

  - name: qwen_grpo
    mode: qwen_worker_grpo
    description: "Qwen 3B with GRPO policy optimization"
    worker_model: models/qwen_grpo_lora
    use_manager: true
    use_cache: true
    use_macros: true

  # === ABLATION EXPERIMENTS ===
  
  # E8: Manager-only (no worker decisions)
  - name: manager_only
    mode: hierarchy_mgr_gate
    description: "Manager always called (no gating)"
    worker_model: gpt-4o-mini
    manager_model: gpt-4o
    use_manager: true
    use_cache: false
    use_macros: false
    manager_warm_start: true
    always_call_manager: true
    
  # E9: Cache-only (no manager)
  - name: cache_only
    mode: hierarchy_vac
    description: "Worker + VAC only (no manager)"
    worker_model: gpt-4o-mini
    use_manager: false
    use_cache: true
    use_macros: false
    
  # E10: Different worker model (gpt-4o instead of mini)
  - name: worker_gpt4o
    mode: baseline_worker
    description: "Worker with gpt-4o (stronger model)"
    worker_model: gpt-4o
    use_manager: false
    use_cache: false
    use_macros: false
    
  # E11: Recovery policies disabled
  - name: no_recovery
    mode: hierarchy_vac_macros
    description: "Full HALO without recovery policies"
    worker_model: gpt-4o-mini
    manager_model: gpt-4o
    use_manager: true
    use_cache: true
    use_macros: true
    enable_recovery_policies: false

# Task subsets for different evaluation scenarios
task_subsets:
  quick_test:
    description: "Quick smoke test (3 tasks)"
    tasks:
      - v2.omnizon-13
      - v2.gomail-1
      - v2.gocalendar-4
      
  shopping:
    description: "Shopping tasks only"
    task_types:
      - omnizon
      
  email:
    description: "Email tasks only"
    task_types:
      - gomail
      
  calendar:
    description: "Calendar tasks only"
    task_types:
      - gocalendar
      
  full:
    description: "All discovered v2 tasks"
    task_types: all

# Metrics to collect
metrics:
  - success_rate
  - avg_steps
  - avg_wall_time
  - invalid_id_rate
  - manager_call_rate
  - cache_hit_rate
  - recovery_action_rate
